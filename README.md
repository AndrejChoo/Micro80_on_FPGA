# Micro80_on_FPGA
Реализация ретрокомпьютера "Микро 80" на FPGA

В качестве центрального процессора использована HDL модель КР580ВМ80А от vslav: https://github.com/1801BM1/vm80a

Видео выводится по HDMI в разрешении 1024х768 в цветном режиме и монохромном режиме.

В качестве видеопамяти (символов и атрибутов )2х2048 байт используется двухпортовая блочная RAM FPGA, знакогенератор (4096 байт) реализован  на блочной ROM FPGA.
Видеорежим 64х32 символа 8х10 пикселей, но программно ограничено на 25 строк.

В качестве ОЗУ и ПЗУ используются либо микросхема SDRAM, либо SRAM (достаточно любой микросхемы SDRAM/SRAM с 8-битной шиной данных минимальным объёмом 128Кб), в том числе реализована дополнительная ОЗУ на 48Кб. Прошивка монитора и CP/M хранятся в микросхеме SPI Flash 25-й серии, при запуске или после сброса данные из флешки переписываются в SDRAM/SRAM и далее считываются уже оттуда. Также в память дополнителного ОЗУ записан интерпретатор BASIC (его можно запустить командой 
"G 0000" или просто "G0" из монитора, а перед использованием BASSIC необходимо ввести команду "NEW", иначе он не будет корректно работать). Для выбора типи микросхемы памяти SRAM/SDRAM добавлена условная компиляция, нужно закомментировать/раскомментировать строки "`define SRAM" и "`define SDRAM" в файлах "micro80.v" и "programmer.v".

В качестве клавиатуры можно использовать PS/2 клавиатуру (у меня работает нестабильно, часто залипает, возможно, моя старая клавиатура работает не совсем корректно), либо
USB клавиатуру через переходник на "Black pill" (stm32f411ceu).

В модели использована не оригинальная прошивка "Монитора", а доработанная. Доработанные прошивки "Монитор" и CP/M, а также шрифт 8х10 взяты из репозитория Алексея Морозова (Алексею отдельное спасибо за помощь): https://github.com/alemorf/retro_computers. При желании можно установить оригинальную прошивку 1983 года, но придётся снизить частоту процессора и немного переделать вывод курсора.

В папке Micro80 файлы проекта, созданного для FPGA Altera (не весь проект целиком, а только HDL файлы и сгенерированные ip блоки). Для FPGA других производителей будет необходимо сгенерировать свои ip блоки pll, блочной памяти, altddio (для модуля HDMI это блоки, которые выводят биты данных на линии tmds и по фронту, и по спаду клока, можно обойтись и без них, но тогда придётся удвоить частоту TMDS_clk для модуля HDMI).

Проект проверен и работает на ПЛИС Altera (Cyclone4 и Cyclone10LP) и Gowin TangNano9k, Xilinx Spartan6 и Xilinx Artix7. 

Для прошивки SPI Flash 25 серии, не имея программатора и не снимая флешки с платы можно использовать мой проект: https://github.com/AndrejChoo/UART_SpiFlash_Programmer_on_FPGA
